!function(e){"function"==typeof define&&define.amd?define(e):e()}((function(){"use strict";void 0!==typeof self&&self;
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var extendStatics=function(e,t){return(extendStatics=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var o in t)t.hasOwnProperty(o)&&(e[o]=t[o])})(e,t)};function __read(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var r,n,i=o.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(error){n={error:error}}finally{try{r&&!r.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}return a}!function(){function GenericStorage(e){void 0===e&&(e={}),this.data=e}Object.defineProperty(GenericStorage.prototype,"data",{get:function(){return this._data},set:function(e){this._data=e},enumerable:!0,configurable:!0}),Object.defineProperty(GenericStorage.prototype,"length",{get:function(){return this.keys.length},enumerable:!0,configurable:!0}),Object.defineProperty(GenericStorage.prototype,"keys",{get:function(){return Object.keys(this.data)},enumerable:!0,configurable:!0}),GenericStorage.prototype.getItem=function(e){return this.data[e]||null},GenericStorage.prototype.setItem=function(e,t){this.data[e]=t},GenericStorage.prototype.removeItem=function(e){delete this.data[e]},GenericStorage.prototype.clear=function(){var e=this;this.keys.forEach((function(t){return e.removeItem(t)}))},GenericStorage.prototype.key=function(e){return this.keys[e]||null}}();function getCookie(e,t){void 0===e&&(e=""),void 0===t&&(t=document.cookie);var o=t.match(new RegExp("(?:^|;\\s*)"+e+"=([^;]*)"));if(o)return o[1]}function setCookie(e,t,o,r,n,i){void 0===o&&(o=""),void 0===r&&(r=14);var a=new Date;n=null!=n?n:window;var u=(i=null!=i?i:/\./.test(n.location.hostname)?n.location.hostname:"").length>0?"domain="+i+"; ":"";a.setTime(a.getTime()+24*r*60*60*1e3);var l="";"https:"===n.location.protocol&&(l="; secure"),n.document.cookie=e+"="+t+"; expires="+a.toUTCString()+"; "+u+"path="+o+l}function removeCookie(e,t,o){setCookie(e,"","/",0,t,o)}
/*! *****************************************************************************
    Copyright (c) Microsoft Corporation. All rights reserved.
    Licensed under the Apache License, Version 2.0 (the "License"); you may not use
    this file except in compliance with the License. You may obtain a copy of the
    License at http://www.apache.org/licenses/LICENSE-2.0

    THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
    KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
    WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
    MERCHANTABLITY OR NON-INFRINGEMENT.

    See the Apache Version 2.0 License for specific language governing permissions
    and limitations under the License.
    ***************************************************************************** */var e=Object.assign||function(e){for(var t,o=1,r=arguments.length;o<r;o++)for(var n in t=arguments[o])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e};function __read$1(e,t){var o="function"==typeof Symbol&&e[Symbol.iterator];if(!o)return e;var r,n,i=o.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(error){n={error:error}}finally{try{r&&!r.done&&(o=i.return)&&o.call(i)}finally{if(n)throw n.error}}return a}function __spread$1(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read$1(arguments[t]));return e}var t="undefined"!=typeof FastBoot?FastBoot.require("buffer").Buffer:"undefined"!=typeof process&&null!==process.versions&&null!==process.versions.node?Buffer:window.Buffer;function memoize(e){return function(){for(var t=[],o=0;o<arguments.length;o++)t[o]=arguments[o];for(var r="",n=t.length;n--;){var i=t[n];r+=i===Object(i)?JSON.stringify(i):i,e._memoized||(e._memoized={})}return r in e._memoized?e._memoized[r]:e._memoized[r]=e.apply(void 0,t)}}function isNodeEnvironment(e){var isDefined=function(e){return null!=e};return 0===arguments.length&&"undefined"!=typeof process&&(e=process),isDefined(e)&&isDefined(e.versions)&&isDefined(e.versions.node)||"undefined"!=typeof FastBoot}memoize(isNodeEnvironment()?function(e){return t.from(e,"base64").toString("binary")}:function(e){return window.atob(e)}),memoize(isNodeEnvironment()?function(e){return t.from(e).toString("base64")}:function(e){return window.btoa(e)});var o=["trace","debug","info","warn","error"],isTopicLog=function(e){return"object"==typeof e&&null!==e&&"string"==typeof e.topic},Nonsole=function(){};o.forEach((function(e){Nonsole.prototype[e]=function(){}}));var r,n=new Nonsole,getConsole=function(){return"undefined"==typeof console?n:console},i="undefined"==typeof localStorage?void 0:localStorage,getConfiguredLevel=function(e,t){return void 0===e&&(e="mk-debug"),void 0===t&&(t=o.length),parseInt(a(e,t),10)},a=memoize((function(e,t){var o,r;return null!==(r=null===(o=null==i?void 0:i.getItem)||void 0===o?void 0:o.call(i,e))&&void 0!==r?r:""+t})),canLogLevel=function(e,t){return-1!==getAllowedLevels(getConfiguredLevel(t)).indexOf(e)},getAllowedLevels=function(e){return isNaN(e)||e<0?[]:o.slice(e)},canLogTopic=function(e,t){var o,r,n=(void 0===(o=t)&&(o="mk-debug-topic"),void 0===r&&(r="*"),a(o,r));return u(n).some((function(t){return t.test(e)}))},u=memoize((function(e){return e.split(/[\s,]+/).map((function(e){var t=e.replace(/\*/g,".*?");return new RegExp("^"+t+"$")}))})),trace=function(t){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];return logMessage.apply(void 0,__spread$1([e({level:"trace"},t)],o))},debug=function(t){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];return logMessage.apply(void 0,__spread$1([e({level:"debug"},t)],o))},warn=function(t){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];return logMessage.apply(void 0,__spread$1([e({level:"warn"},t)],o))},error=function(t){for(var o=[],r=1;r<arguments.length;r++)o[r-1]=arguments[r];return logMessage.apply(void 0,__spread$1([e({level:"error"},t)],o))},log=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];return logMessage.apply(void 0,__spread$1([e],t))},logMessage=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];var r=e.level,n=e.levelKey,i=e.topic,a=e.topicKey;if(canLogLevel(r=null!=r?r:"debug",n)&&canLogTopic(i,a)){var u=getConsole();if("function"==typeof u[r]){var l=__read$1(t),s=l[0],d=l.slice(1);void 0!==i&&(s=i+": "+s),u[r].apply(u,__spread$1([s],d))}}},l=function(){function Logger(e){var t,o,r,n;this._levelFilterKey="mk-debug","string"==typeof e?(this._levelFilterKey=e,this.level=getConfiguredLevel(this._levelFilterKey,5)):"object"==typeof e?(this._levelFilterKey=null!==(t=e.levelFilterStorageKey)&&void 0!==t?t:this._levelFilterKey,this._topicFilterKey=null!==(o=e.topicFilterStorageKey)&&void 0!==o?o:this.generateDefaultTopicFilterStorageKey(this._levelFilterKey),this.topic=e.topic,this.level=null!==(r=e.level)&&void 0!==r?r:getConfiguredLevel(this._levelFilterKey,5)):this.level=null!=e?e:getConfiguredLevel(this._levelFilterKey,5),this._topicFilterKey=null!==(n=this._topicFilterKey)&&void 0!==n?n:this.generateDefaultTopicFilterStorageKey(this._levelFilterKey)}return Object.defineProperty(Logger.prototype,"enabled",{get:function(){return this.level<5},set:function(e){this.level=e?1:5},enumerable:!0,configurable:!0}),Logger.prototype.debug=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.callLogMethod.apply(this,__spread$1([debug,e],t))},Logger.prototype.error=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.callLogMethod.apply(this,__spread$1([error,e],t))},Logger.prototype.log=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.callLogMethod.apply(this,__spread$1([log,e],t))},Logger.prototype.trace=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.callLogMethod.apply(this,__spread$1([trace,e],t))},Logger.prototype.warn=function(e){for(var t=[],o=1;o<arguments.length;o++)t[o-1]=arguments[o];this.callLogMethod.apply(this,__spread$1([warn,e],t))},Logger.prototype.callLogMethod=function(e,t){for(var o,r,n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];var a={levelKey:this._levelFilterKey,topicKey:this._topicFilterKey,topic:this.topic},u=t;isTopicLog(t)&&(a.topic=null!==(o=t.topic)&&void 0!==o?o:a.topic,u=null!==(r=t.message)&&void 0!==r?r:n.shift()),e.apply(void 0,__spread$1([a,u],n))},Logger.prototype.generateDefaultTopicFilterStorageKey=function(e){return e+"-topic"},Logger}(),s=(new l,new l("sk-debug"));!function(e){e.DEFAULT_CID="pldfltcid",e.TV_CID="pltvcid",e.RESTRICTIONS_ENABLED="itre",e.STOREFRONT_COUNTRY_CODE="itua",e.USER_TOKEN="media-user-token"}(r||(r={}));var d=function(){function AuthBridgeBase(){this._targetOrigin="*"}return AuthBridgeBase.prototype.init=function(e,t){var o;this._receiveWindow=e,this._sendWindow=t,this.handleMessage=this.handleMessage.bind(this),null===(o=this._receiveWindow)||void 0===o||o.addEventListener("message",this.handleMessage)},AuthBridgeBase.prototype.sendMessage=function(e,t){var o={action:"mediakit:"+e,data:t};this._sendWindow&&this._sendWindow.postMessage(JSON.stringify(o),this._targetOrigin)},AuthBridgeBase.prototype.handleMessage=function(e){if(this._isOriginAllowed(e.origin)){var t;try{t=JSON.parse(e.data)}catch(r){}if(t&&this._isNamespacedData(t)){"*"===this._targetOrigin&&(this._targetOrigin=e.origin),s.debug("auth-bridge: handleMessage",t);var o=t.action.replace("mediakit:","");this[o]?this[o](t.data):s.debug("auth-bridge: unsupported method",o)}}},AuthBridgeBase.prototype._isOriginAllowed=function(e){if(!e)return!1;var t=__read(e.split("://"),2),o=t[0],r=t[1],n="";return r&&(n=r.split(":")[0]),"https"===o&&!!n&&n.endsWith(".apple.com")},AuthBridgeBase.prototype._isNamespacedData=function(e){return e.action&&-1!==e.action.indexOf("mediakit:")},AuthBridgeBase}(),c=Object.keys(r).map((function(e){return r[e]}));function setFrameCookie(e,t){s.debug("auth-bridge: setFrameCookie",e,t),(t=null!=t?t:"")?setCookie(e,t,"/",7):removeCookie(e)}(new(function(e){function AuthBridgeFrame(t){var o,r,n,i,a=e.call(this)||this;return a._cookieNames=function(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(__read(arguments[t]));return e}(c),a._enabled=!0,t&&t.hasOwnProperty("enabled")&&(a._enabled=t.enabled),a.debouncedRequestAuthUpdate=(o=a.requestAuthUpdate.bind(a),void 0===(r=2e3)&&(r=250),void 0===n&&(n={isImmediate:!1}),function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var a=this,doLater=function(){i=void 0,n.isImmediate||o.apply(a,e)},u=n.isImmediate&&void 0===i;void 0!==i&&clearTimeout(i),i=setTimeout(doLater,r),u&&o.apply(a,e)}),a.onStorageChange=a.onStorageChange.bind(a),window.addEventListener("storage",a.onStorageChange),a.init(window,window.parent),a}return function(e,t){function __(){this.constructor=e}extendStatics(e,t),e.prototype=null===t?Object.create(t):(__.prototype=t.prototype,new __)}(AuthBridgeFrame,e),AuthBridgeFrame.prototype.destroy=function(){window.removeEventListener("storage",this.onStorageChange)},AuthBridgeFrame.prototype.sendFrameInit=function(){this.sendMessage("frameInit")},AuthBridgeFrame.prototype.onStorageChange=function(e){var t,o=null===(t=e.key)||void 0===t?void 0:t.replace("mk-auth-bridge-storage-event-","");"cookie-updated"===o?this.debouncedRequestAuthUpdate():"auth-cleared"===o&&this.sendMessage("authClearedFromOtherFrame")},AuthBridgeFrame.prototype.sendStorageEvent=function(e){if("undefined"!=typeof localStorage)try{localStorage.setItem("mk-auth-bridge-storage-event-"+e,""+Date.now())}catch(t){}},AuthBridgeFrame.prototype.requestAuthUpdate=function(){var e=this,t={},o={enabled:this._enabled,cookies:t};this._cookieNames.forEach((function(o){var r=getCookie(o);r?(t[o]=r,e._enabled&&setFrameCookie(o,r)):t[o]=null})),this.sendMessage("updateAuth",o),this._enabled&&setTimeout((function(){return e._cookieNames.forEach((function(e){return removeCookie(e,window,"apple.com")}))}),1e3)},AuthBridgeFrame.prototype.setCookieItem=function(e){var t=e.name,o=e.value;this._enabled&&setFrameCookie(t,o),this.debouncedRequestAuthUpdate(),this.sendStorageEvent("cookie-updated")},AuthBridgeFrame.prototype.clearAuth=function(){var e=this,t=!1;this._cookieNames.forEach((function(o){getCookie(o)&&(t=!0),e._enabled&&removeCookie(o)})),this.requestAuthUpdate(),t&&this.sendStorageEvent("auth-cleared")},AuthBridgeFrame}(d))).sendFrameInit()}));
